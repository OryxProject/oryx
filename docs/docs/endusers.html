
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2016-10-03
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Oryx &#x2013; Docs: End Users</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="../css/bootswatch.css" rel="stylesheet" />
		<link href="../css/reflow-skin.css" rel="stylesheet" />


		<link href="../css/lightbox.css" rel="stylesheet" />

		<link href="../css/site.css" rel="stylesheet" />
		<link href="../css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->



	</head>

	<body class="page-docs-endusers project-oryx" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="index.html">Oryx 2</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="../index.html" title="Overview">Overview</a></li>
							<li class="active"><a href="" title="Docs: End Users">Docs: End Users</a></li>
							<li ><a href="developer.html" title="Docs: Dev">Docs: Dev</a></li>
							<li ><a href="admin.html" title="Docs: Admin">Docs: Admin</a></li>
							<li ><a href="performance.html" title="Performance">Performance</a></li>
							<li ><a href="../apidocs/index.html" title="Javadoc">Javadoc</a></li>
							<li ><a href="https://github.com/OryxProject/oryx/releases" title="Download" class="externalLink">Download</a></li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<div class="page-header">
 <h1 id="running">Running</h1>
</div> 
<div class="section"> 
 <h2 id="Setup">Setup</h2> 
 <p>You must have set up and configured your cluster as shown in the <a href="admin.html">Admin docs</a>.</p> 
 <p>In particular, you should have already installed Java 8 on your cluster. In order to make subsequent <tt>oryx-run.sh</tt> commands work, it is likely necessary to update the default Java version with <tt>update-alternatives --config java</tt> or equivalent to select Java 8, and set <tt>JAVA_HOME</tt> to point to the Java 8 installation.</p> 
 <p>Download the <a class="externalLink" href="https://github.com/OryxProject/oryx/releases">latest release</a> of the Oryx Batch, Speed and Serving Layer, both <tt>.jar</tt> files and <tt>.sh</tt> scripts. Alternatively, build them from source and obtain the latest scripts from <a class="externalLink" href="https://github.com/OryxProject/oryx/blob/master/deploy/bin">deploy/bin/</a>.</p> 
 <p>Copy binaries and scripts to machines that are part of the Hadoop cluster. They may be deployed on different machines, or on one for purposes of testing. The Speed and Batch Layers should run on at most one machine, each. The Serving Layer can run on many.</p> 
 <p>Create a configuration file for your application. You may start with the example in <a class="externalLink" href="https://github.com/OryxProject/oryx/blob/master/app/conf/als-example.conf">conf/als-example.conf</a>. Modify host names, ports and directories. In particular, choose data and model directories on HDFS that exist and will be accessible to the user running Oryx binaries.</p> 
 <p>Copy this config file as <tt>oryx.conf</tt> to the same directory as binaries and script on each machine.</p> 
</div> 
<div class="section"> 
 <h2 id="Execute">Execute</h2> 
 <p>Run the three Layers with:</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>./oryx-run.sh batch
./oryx-run.sh speed
./oryx-run.sh serving
</pre> 
  </div> 
 </div> 
 <p><tt>--layer-jar your-layer.jar</tt> and <tt>--conf your-config.conf</tt> can be used to specify an alternative location of the layer <tt>.jar</tt> and/or <tt>.conf</tt> file. You can use <tt>--jvm-args</tt> to pass more arguments directly the Spark driver program, like system properties: <tt>--jvm-args=&quot;-Dkey=value&quot;</tt></p> 
 <p>These need not be on the same machine, but may be (if configuration specifies different ports for the Batch and Speed Layer Spark web UI, and the Serving Layer API port). The Serving Layer may be run on several machines.</p> 
 <p>You can see, for example, the Batch Layer Spark UI running on port 4040 of the machine on which you started it (unless your configuration changed this). A simple web-based console for the Serving Layer is likewise available on port 8080 by default.</p> 
 <p>Thatâ€™s all!</p> 
</div> 
<div class="section"> 
 <h2 id="Trying_the_ALS_Example">Trying the ALS Example</h2> 
 <p>If youâ€™ve used the configuration above, you are running an instance of the ALS-based recommender application.</p> 
 <p>Obtain the <a class="externalLink" href="http://grouplens.org/datasets/movielens/">GroupLens 100K</a> data set and find the <tt>u.data</tt> file within. This needs to be converted to csv:</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>tr '\t' ',' &lt; u.data &gt; data.csv
</pre> 
  </div> 
 </div> 
 <p>Push the input to a Serving Layer, with a local command line tool like <tt>curl</tt>:</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>wget --quiet --post-file data.csv --output-document - \
  --header &quot;Content-Type: text/csv&quot; \
  http://your-serving-layer:8080/ingest
</pre> 
  </div> 
 </div> 
 <p>If you are tailing the input topic, you should see a large amount of CSV data flow to the topic:</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>196,242,3.0,881250949186
196,242,3.0,881250949
186,302,3.0,891717742
22,377,1.0,878887116
244,51,2.0,880606923
166,346,1.0,886397596
298,474,4.0,884182806
...
</pre> 
  </div> 
 </div> 
 <p>Soon, you should also see the Batch Layer trigger a new computation. The example configuration starts one every 5 minutes.</p> 
 <p>The data is first written to HDFS. The example configuration has it written to directories under <tt>hdfs:///user/example/Oryx/data/</tt>. Within are directories named by timestamp, each containing Hadoop <tt>part-r-*</tt> files, which contain the input as <tt>SequenceFile</tt>s of <tt>Text</tt>. Although not pure text, printing them should yield some recognizable data because it is in fact text.</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>SEQorg.apache.hadoop.io.Textorg.apache.hadoop.io.Textï¿½ï¿½ï¿½ï¿½^ï¿½]ï¿½XØ³Nï¿½22,377,1.0,87888711662...
</pre> 
  </div> 
 </div> 
 <p>A model computation then begins. This should show as a number of new distributed jobs the Batch Layer. Its Spark UI is started at <tt>http://your-batch-layer:4040</tt> in the example configuration.</p> 
 <p>Soon the model will complete, and it will be persisted as a combination of PMML and supporting data files in a subdirectory of <tt>hdfs:///user/example/Oryx/model/</tt>. For example, the <tt>model.pmml</tt> files are PMML files containing elements like:</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;PMML xmlns=&quot;http://www.dmg.org/PMML-4_2&quot; version=&quot;4.2.1&quot;&gt;
    &lt;Header&gt;
        &lt;Application name=&quot;Oryx&quot;/&gt;
        &lt;Timestamp&gt;2014-12-18T04:48:54-0800&lt;/Timestamp&gt;
    &lt;/Header&gt;
    &lt;Extension name=&quot;X&quot; value=&quot;X/&quot;/&gt;
    &lt;Extension name=&quot;Y&quot; value=&quot;Y/&quot;/&gt;
    &lt;Extension name=&quot;features&quot; value=&quot;10&quot;/&gt;
    &lt;Extension name=&quot;lambda&quot; value=&quot;0.001&quot;/&gt;
    &lt;Extension name=&quot;implicit&quot; value=&quot;true&quot;/&gt;
    &lt;Extension name=&quot;alpha&quot; value=&quot;1.0&quot;/&gt;
    &lt;Extension name=&quot;implicit&quot; value=&quot;false&quot;/&gt;
    &lt;Extension name=&quot;XIDs&quot;&gt;56 168 222 343 397 ...
     ...
</pre> 
  </div> 
 </div> 
 <p>The <tt>X/</tt> and <tt>Y/</tt> subdirectories next to it contain feature vectors, like:</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>[56,[0.5746282834154238,-0.08896614131333057,-0.029456222765775263,
  0.6039821219690552,0.1497901814774658,-0.018654312114339863,
  -0.37342063488340266,-0.2370768843521807,1.148260034028485,
  1.0645643656769153]]
[168,[0.8722769882777296,0.4370416943031704,0.27402044461549885,
  -0.031252701117490456,-0.7241385753098256,0.026079081002582338,
  0.42050973702065714,0.27766923396205817,0.6241033215856671,
  -0.48530795198811266]]
...
</pre> 
  </div> 
 </div> 
 <p>If you are tailing the update topic, you should also see these values published to the topic.</p> 
 <p>The Serving Layer will pick this up soon thereafter, and the <tt>/ready</tt> endpoint will return status <tt>200 OK</tt>:</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>wget --quiet --output-document - --server-response \
  http://your-serving-layer:8080/ready
...
  HTTP/1.1 200 OK
  Content-Length: 0
  Date: Tue, 1 Sep 2015 13:26:53 GMT
  Server: Oryx
</pre> 
  </div> 
 </div> 
 <div class="source"> 
  <div class="source"> 
   <pre>wget --quiet --output-document -  http://your-serving-layer:8080/recommend/17
...
50,0.7749542842056966
275,0.7373013861581563
258,0.731818692628511
181,0.7049967175706345
127,0.704518989947498
121,0.7014631029793741
15,0.6954683387287907
288,0.6774889711024022
25,0.6663619887033064
285,0.6398968471343595
</pre> 
  </div> 
 </div> 
 <p>Congratulations, itâ€™s a live recommender! When done, all processes can be killed with Ctrl-C safely.</p> 
 <h1 id="api_endpoint_reference">API Endpoint Reference</h1> 
 <p>Oryx bundles several end-to-end applications, including a Serving Layer with REST endpoints.</p> 
</div> 
<div class="section"> 
 <h2 id="Collaborative_filtering__Recommendation">Collaborative filtering / Recommendation</h2> 
 <ul> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Recommend.html"><tt>/recommend</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/RecommendToMany.html"><tt>/recommendToMany</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/RecommendToAnonymous.html"><tt>/recommendToAnonymous</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/RecommendWithContext.html"><tt>/recommendWithContext</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Similarity.html"><tt>/similarity</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/SimilarityToItem.html"><tt>/similarityToItem</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/KnownItems.html"><tt>/knownItems</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Estimate.html"><tt>/estimate</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/EstimateForAnonymous.html"><tt>/estimateForAnonymous</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Because.html"><tt>/because</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/MostSurprising.html"><tt>/mostSurprising</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/PopularRepresentativeItems.html"><tt>/popularRepresentativeItems</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/MostActiveUsers.html"><tt>/mostActiveUsers</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/MostPopularItems.html"><tt>/mostPopularItems</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/MostActiveUsers.html"><tt>/mostActiveUsers</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/AllItemIDs.html"><tt>/item/allIDs</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/Ready.html"><tt>/ready</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Preference.html"><tt>/pref</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/als/Ingest.html"><tt>/ingest</tt></a></li> 
 </ul> 
</div> 
<div class="section"> 
 <h2 id="Classification__Regression">Classification / Regression</h2> 
 <ul> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/rdf/Predict.html"><tt>/predict</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/rdf/ClassificationDistribution.html"><tt>/classificationDistribution</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/Ready.html"><tt>/ready</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/rdf/Train.html"><tt>/train</tt></a></li> 
 </ul> 
</div> 
<div class="section"> 
 <h2 id="Clustering">Clustering</h2> 
 <ul> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/kmeans/Assign.html"><tt>/assign</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/kmeans/DistanceToNearest.html"><tt>/distanceToNearest</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/Ready.html"><tt>/ready</tt></a></li> 
  <li><a class="externalLink" href="http://oryx.io/apidocs/com/cloudera/oryx/app/serving/kmeans/Add.html"><tt>/add</tt></a></li> 
 </ul> 
 <h1 id="configuration">Configuration</h1> 
 <p>Refer to the default configuration file for a list and explanation of configuration parameters: <a class="externalLink" href="https://github.com/OryxProject/oryx/blob/master/framework/oryx-common/src/main/resources/reference.conf"><tt>reference.conf</tt></a></p> 
 <p>Or see one of the following examples:</p> 
 <ul> 
  <li><a class="externalLink" href="https://github.com/OryxProject/oryx/blob/master/app/conf/als-example.conf"><tt>app/conf/als-example.conf</tt></a></li> 
  <li><a class="externalLink" href="https://github.com/OryxProject/oryx/blob/master/app/conf/kmeans-example.conf"><tt>app/conf/kmeans-example.conf</tt></a></li> 
  <li><a class="externalLink" href="https://github.com/OryxProject/oryx/blob/master/app/conf/rdf-example.conf"><tt>app/conf/rdf-example.conf</tt></a></li> 
 </ul> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#running" title="Running">Running <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Setup" title="Setup">Setup</a>
		<li><a href="#Execute" title="Execute">Execute</a>
		<li><a href="#Trying_the_ALS_Example" title="Trying the ALS Example">Trying the ALS Example</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li class="dropdown"><a href="#api_endpoint_reference" title="API Endpoint Reference">API Endpoint Reference <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Collaborative_filtering__Recommendation" title="Collaborative filtering / Recommendation">Collaborative filtering / Recommendation</a>
		<li><a href="#Classification__Regression" title="Classification / Regression">Classification / Regression</a>
		<li><a href="#Clustering" title="Clustering">Clustering</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li><a href="#configuration" title="Configuration">Configuration</a>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span9 bottom-nav">
					<ul class="nav nav-list">
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2014-2016. All Rights Reserved.</p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="../js/lightbox.min.js"></script>
	<script src="../js/reflow-scroll.js"></script>

	<script src="../js/reflow-skin.js"></script>

	</body>
</html>
